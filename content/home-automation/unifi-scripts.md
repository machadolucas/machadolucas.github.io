---
title: "UniFi Scripts"
summary: "Some scripts I have created for managing my home network"
date: 2025-05-03
tags:
  - Ubiquiti
  - Unifi
  - Servers
fileName: "UniFi Scripts.md"
---

# **UNAS Pro and UDM Pro fan controller**

Find the updated gist [**here**](https://gist.github.com/machadolucas/c616f46568a4932d4eabfb941fa5c3ea)

## **SSH**
`ssh root@<ip>`

## **Install fancontrol if its not already done**
### **UniFI OS version >= 4.2.9**
From version 4.2.9, `fancontrol` was removed from `apt`, so we need to manually download and install the script. `fancontrol` itself is just a long bash script.
```bash
# 1.  Fetch the script
curl -fsSL https://raw.githubusercontent.com/lm-sensors/lm-sensors/master/prog/pwm/fancontrol \
     -o /usr/sbin/fancontrol

# 2.  Make it executable
chmod +x /usr/sbin/fancontrol
```

Create the systemd unit:
```ini
# /etc/systemd/system/fancontrol.service
[Unit]
Description=Fan speed control
After=lm-sensors.service
ConditionPathExists=/etc/fancontrol

[Service]
Type=simple
ExecStart=/usr/sbin/fancontrol
Restart=always

[Install]
WantedBy=multi-user.target
```

### **UniFI OS version < 4.2.9**
`apt list fancontrol 2> /dev/null | grep "installed" && echo "fancontrol already installed" || (echo "Installing fancontrol" && apt install fancontrol -y)`

## **Save fancontrol configurations to `/etc/fancontrol`**
Create the file if it does not exist. Tweak as needed. These configs for me keep the console at about 50C or lower, and drives below 40C.
Documentation: http://man.he.net/man8/fancontrol
```
# Configuration file generated by pwmconfig, changes will be lost
INTERVAL=1
DEVPATH=hwmon0=devices/platform/soc/fd880000.i2c-pld/i2c-0/i2c-4/4-002e
DEVNAME=hwmon0=adt7475
FCTEMPS=hwmon0/pwm2=hwmon0/temp3_input hwmon0/pwm1=hwmon0/temp3_input
FCFANS=hwmon0/pwm2=hwmon0/fan2_input hwmon0/pwm1=hwmon0/fan1_input
MINTEMP=hwmon0/pwm2=40 hwmon0/pwm1=40
MAXTEMP=hwmon0/pwm2=75 hwmon0/pwm1=75
MINSTART=hwmon0/pwm2=60 hwmon0/pwm1=60
MINSTOP=hwmon0/pwm2=30 hwmon0/pwm1=30
MINPWM=hwmon0/pwm2=30 hwmon0/pwm1=30
MAXPWM=hwmon0/pwm2=255 hwmon0/pwm1=255

```

## **Start service**
### **UniFI OS version >= 4.2.9**
```bash
systemctl daemon-reload
systemctl enable --now fancontrol
```

### **UniFI OS version < 4.2.9**
`service fancontrol start`

## **Monitor**
To watch live data about fan speeds, pwd setting and temperatures like this:
<img width="472" alt="image" src="https://gist.github.com/user-attachments/assets/b4f1293c-56a6-47fb-9f14-9da48db8fb6d" />

```
watch -n1 "sensors && \
           cat /sys/class/hwmon/hwmon0/pwm[12] | \
           xargs -I{} printf '   PWM: {}\n'"
```

## **Bonus for UDM Pro:**

Perform the same process, but use this instead for `/etc/fancontrol`:
```
# Configuration file generated by pwmconfig, changes will be lost
INTERVAL=1
DEVPATH=hwmon0=devices/platform/soc/fd880000.i2c-pld/i2c-0/i2c-4/4-002e
DEVNAME=hwmon0=adt7475
FCTEMPS=hwmon0/device/pwm2=hwmon0/device/temp1_input hwmon0/device/pwm1=hwmon0/device/temp3_input
FCFANS=hwmon0/device/pwm2=hwmon0/device/fan2_input hwmon0/device/pwm1=hwmon0/device/fan1_input
MINTEMP=hwmon0/device/pwm1=35 hwmon0/device/pwm2=35
MAXTEMP=hwmon0/device/pwm1=52 hwmon0/device/pwm2=52
MINSTART=hwmon0/device/pwm1=60 hwmon0/device/pwm2=60
MINSTOP=hwmon0/device/pwm1=75 hwmon0/device/pwm2=60
MINPWM=hwmon0/device/pwm1=75 hwmon0/device/pwm2=60
MAXPWM=hwmon0/device/pwm1=255 hwmon0/device/pwm2=255

```
For UDM Pro:
PWM1/TEMP3/FAN1 = Disk fan (only runs if there is a disk inserted)
PWM2/TEMP1/FAN2 = CPU fan
