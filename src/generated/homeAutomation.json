{
  "generatedAt": "2025-11-02T17:44:19.895Z",
  "count": 2,
  "homeAutomation": [
    {
      "slug": "unifi-scripts",
      "title": "UniFi Scripts",
      "summary": "Some scripts I have created for managing my home network",
      "date": "2025-05-03T00:00:00.000Z",
      "tags": [
        "Ubiquiti",
        "Unifi",
        "Servers"
      ],
      "fileName": "UniFi Scripts.md",
      "contentHtml": "<h1><strong>UNAS Pro and UDM Pro fan controller</strong></h1>\n<p>Find the updated gist <a target=\"_blank\" rel=\"noreferrer noopener\" href=\"https://gist.github.com/machadolucas/c616f46568a4932d4eabfb941fa5c3ea\"><strong>here</strong></a></p>\n<h2><strong>SSH</strong></h2>\n<p><code>ssh root@&lt;ip&gt;</code></p>\n<h2><strong>Install fancontrol if its not already done</strong></h2>\n<h3><strong>UniFI OS version &gt;= 4.2.9</strong></h3>\n<p>From version 4.2.9, <code>fancontrol</code> was removed from <code>apt</code>, so we need to manually download and install the script. <code>fancontrol</code> itself is just a long bash script.</p>\n<pre><code class=\"language-bash\"># 1.  Fetch the script\ncurl -fsSL https://raw.githubusercontent.com/lm-sensors/lm-sensors/master/prog/pwm/fancontrol \\\n     -o /usr/sbin/fancontrol\n\n# 2.  Make it executable\nchmod +x /usr/sbin/fancontrol\n</code></pre>\n<p>Create the systemd unit:</p>\n<pre><code class=\"language-ini\"># /etc/systemd/system/fancontrol.service\n[Unit]\nDescription=Fan speed control\nAfter=lm-sensors.service\nConditionPathExists=/etc/fancontrol\n\n[Service]\nType=simple\nExecStart=/usr/sbin/fancontrol\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<h3><strong>UniFI OS version &lt; 4.2.9</strong></h3>\n<p><code>apt list fancontrol 2&gt; /dev/null | grep &quot;installed&quot; &amp;&amp; echo &quot;fancontrol already installed&quot; || (echo &quot;Installing fancontrol&quot; &amp;&amp; apt install fancontrol -y)</code></p>\n<h2><strong>Save fancontrol configurations to <code>/etc/fancontrol</code></strong></h2>\n<p>Create the file if it does not exist. Tweak as needed. These configs for me keep the console at about 50C or lower, and drives below 40C.\nDocumentation: <a target=\"_blank\" rel=\"noreferrer noopener\" href=\"http://man.he.net/man8/fancontrol\">http://man.he.net/man8/fancontrol</a></p>\n<pre><code># Configuration file generated by pwmconfig, changes will be lost\nINTERVAL=1\nDEVPATH=hwmon0=devices/platform/soc/fd880000.i2c-pld/i2c-0/i2c-4/4-002e\nDEVNAME=hwmon0=adt7475\nFCTEMPS=hwmon0/pwm2=hwmon0/temp3_input hwmon0/pwm1=hwmon0/temp3_input\nFCFANS=hwmon0/pwm2=hwmon0/fan2_input hwmon0/pwm1=hwmon0/fan1_input\nMINTEMP=hwmon0/pwm2=40 hwmon0/pwm1=40\nMAXTEMP=hwmon0/pwm2=75 hwmon0/pwm1=75\nMINSTART=hwmon0/pwm2=60 hwmon0/pwm1=60\nMINSTOP=hwmon0/pwm2=30 hwmon0/pwm1=30\nMINPWM=hwmon0/pwm2=30 hwmon0/pwm1=30\nMAXPWM=hwmon0/pwm2=255 hwmon0/pwm1=255\n</code></pre>\n<h2><strong>Start service</strong></h2>\n<h3><strong>UniFI OS version &gt;= 4.2.9</strong></h3>\n<pre><code class=\"language-bash\">systemctl daemon-reload\nsystemctl enable --now fancontrol\n</code></pre>\n<h3><strong>UniFI OS version &lt; 4.2.9</strong></h3>\n<p><code>service fancontrol start</code></p>\n<h2><strong>Monitor</strong></h2>\n<p>To watch live data about fan speeds, pwd setting and temperatures like this:\n<img width=\"472\" alt=\"image\" src=\"https://gist.github.com/user-attachments/assets/b4f1293c-56a6-47fb-9f14-9da48db8fb6d\" /></p>\n<pre><code>watch -n1 &quot;sensors &amp;&amp; \\\n           cat /sys/class/hwmon/hwmon0/pwm[12] | \\\n           xargs -I{} printf &#39;   PWM: {}\\n&#39;&quot;\n</code></pre>\n<h2><strong>Bonus for UDM Pro:</strong></h2>\n<p>Perform the same process, but use this instead for <code>/etc/fancontrol</code>:</p>\n<pre><code># Configuration file generated by pwmconfig, changes will be lost\nINTERVAL=1\nDEVPATH=hwmon0=devices/platform/soc/fd880000.i2c-pld/i2c-0/i2c-4/4-002e\nDEVNAME=hwmon0=adt7475\nFCTEMPS=hwmon0/device/pwm2=hwmon0/device/temp1_input hwmon0/device/pwm1=hwmon0/device/temp3_input\nFCFANS=hwmon0/device/pwm2=hwmon0/device/fan2_input hwmon0/device/pwm1=hwmon0/device/fan1_input\nMINTEMP=hwmon0/device/pwm1=35 hwmon0/device/pwm2=35\nMAXTEMP=hwmon0/device/pwm1=52 hwmon0/device/pwm2=52\nMINSTART=hwmon0/device/pwm1=60 hwmon0/device/pwm2=60\nMINSTOP=hwmon0/device/pwm1=75 hwmon0/device/pwm2=60\nMINPWM=hwmon0/device/pwm1=75 hwmon0/device/pwm2=60\nMAXPWM=hwmon0/device/pwm1=255 hwmon0/device/pwm2=255\n</code></pre>\n<p>For UDM Pro:\nPWM1/TEMP3/FAN1 = Disk fan (only runs if there is a disk inserted)\nPWM2/TEMP1/FAN2 = CPU fan</p>\n",
      "sourceFile": "unifi-scripts.md"
    },
    {
      "slug": "water-meter-ocr",
      "title": "Water Meter OCR",
      "summary": "Some scripts I have created for managing my home network",
      "date": "2025-11-02T00:00:00.000Z",
      "tags": [
        "ESP32",
        "Water meter",
        "OCR"
      ],
      "fileName": "Water Meter OCR.md",
      "contentHtml": "<h1><strong>Reading a Mechanical Water Meter with an ESP32 + Mac</strong></h1>\n<p align=\"center\">\n  <img src=\"https://github.com/machadolucas/watermeter_ocr/raw/main/overlay_example.jpg\" alt=\"Water meter overlay example\" width=\"520\">\n</p>\n\n<p>I built a small system that reads a traditional water meter (five odometer digits + four red-pointer dials) using an <strong>ESP32-S3 AI-on-the-Edge Cam</strong> for image capture and my <strong>Mac Mini</strong> for the heavy lifting. The ESP32 (PoE) snaps a lit photo every few seconds; a Python service on the Mac handles alignment (so small camera shifts don’t break things), per-digit OCR with rolling-digit logic, dial detection, and publishes everything to <strong>Home Assistant</strong> over MQTT: total m³, m³/min, <strong>L/min</strong>, plus a live debug overlay image.</p>\n<p>Why offload to the Mac? It’s faster and more reliable for OCR, while keeping the ESP32 simple.</p>\n<p>The original project which runs image recognition directly on the ESP32 device takes a few minutes for each image capture, while by using a Mac I can perform recognition every 10-seconds interval or faster without noticiable load (as even the NPU is used with Apple Vision). This allows me for almost instant water flow detection.</p>\n<p>The project includes an installer, reference-image alignment, guards against negative flow or big jumps, and a clean overlay to help tweak ROIs. It’s open source here: <strong><a target=\"_blank\" rel=\"noreferrer noopener\" href=\"https://github.com/machadolucas/watermeter_ocr\">github.com/machadolucas/watermeter_ocr</a></strong>.</p>\n",
      "sourceFile": "water-meter-ocr.md"
    }
  ]
}